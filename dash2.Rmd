---
title: <center> Max Portfolio </center>
date: <center>'`r format(Sys.time(), "%d %B, %Y")`'</center>
output: 
  html_document:
    includes:
      after_body: footer.html
---


```{r echo=T, results='hide', echo=FALSE}
suppressMessages(source('profileRep.R'))
load("Data/Portfolio_Market.RData")
```

  
# Open Positions:

```{r include = TRUE, echo=FALSE, fig.align='center'}
dp$risk %>% subset(dp$risk$SharePortfolio>0.0001 | dp$risk$Name == 'Portfolio:'
                   ,select=names(dp$risk)[c(2:18,28,37,40,42,44)]) %>%
  mutate(std_log_returns = std_log_returns * 100) %>% 
  mutate(std_log_returns_1Y = std_log_returns_1Y * 100) %>%
  mutate(VolaN1_MSGARCH = VolaN1_MSGARCH * 100) %>%
  dplyr::rename(`ind VaR MSGARCH`=ind_VaR_MSGARCH)%>%
  dplyr::rename(`250D CAPM Return`=`250D.CAPM.Return`)%>%
  dplyr::rename(`250D log Return`=`250D.logReturn`)%>%
  dplyr::rename(`Jensen Alpha`=Jensen.Alpha)%>%
  dplyr::rename(`std log returns`=std_log_returns)%>%  
  dplyr::rename(`std log returns 1Y`=std_log_returns_1Y)%>%  
  dplyr::rename(`std N1 MSGARCH`= VolaN1_MSGARCH)%>%
  dplyr::rename(`ES MSGARCH`= ES_MSGARCH)%>%
  plyr::arrange(!SharePortfolio)  -> risk.Table 

#c(-1,-25,-26,-29,-30,-32,-33,-39,-40,-42)
risk.Table <- replace(risk.Table, is.na(risk.Table),0)

datatable(risk.Table,
            extensions = 'Buttons', options = list(pageLength = 100,
    dom = 'Bfrtip',
    buttons = list('copy', 'csv', 'excel', 'pdf', 'print',
    list(extend = 'colvis',visible=F, targets= 0, columns = c(3:dim(risk.Table)[2])))
        )) %>%
  formatRound('Value', digits = 0, interval = 3, mark = " ")%>%
  formatPercentage('SharePortfolio', 1) %>%
  formatStyle('SharePortfolio', background = color_from_middle(risk.Table$SharePortfolio,'pink','lightblue')) %>%
  formatRound('Beta', digits = 2, interval = 3, mark = " ")%>%
  formatStyle('Beta', background = color_from_middle(risk.Table$Beta,'pink','pink')) %>%
  formatRound('Beta1Y', digits = 2, interval = 3, mark = " ")%>%
  formatStyle('Beta1Y', background = color_from_middle(risk.Table$Beta1Y,'pink','pink')) %>%
  formatPercentage('250D log Return', 1) %>%
  formatStyle('250D log Return', background = color_from_middle(risk.Table$`250D log Return`,'pink','pink')) %>%
  formatPercentage('250D CAPM Return', 1) %>%
  formatStyle('250D CAPM Return', background = color_from_middle(risk.Table$`250D CAPM Return`,'pink','pink')) %>%
    formatRound('Jensen Alpha', digits = 2, interval = 3, mark = " ")%>%
  formatStyle('Jensen Alpha', background = color_from_middle(risk.Table$`Jensen Alpha`,'pink','lightblue')) %>%
 formatRound('std log returns', digits = 1, interval = 3, mark = " ")%>%
 formatStyle('std log returns', background = color_from_middle(risk.Table$`std log returns`,'pink','pink')) %>%
 formatRound('std log returns 1Y', digits = 1, interval = 3, mark = " ")%>%
 formatStyle('std log returns 1Y', background = color_from_middle(risk.Table$`std log returns 1Y`,'pink','pink')) %>%
    formatRound('std N1 MSGARCH', digits = 1, interval = 3, mark = " ")%>%
  formatStyle('std N1 MSGARCH', background = color_from_middle(risk.Table$`std N1 MSGARCH`,'pink','pink')) %>%
  formatPercentage('VaR Normal std1Y', 1) %>%
  formatStyle('VaR Normal std1Y', background = color_from_middle(risk.Table$`VaR Normal std1Y`,'pink','pink')) %>%
  formatPercentage('VaR Normal', 1) %>%
  formatStyle('VaR Normal', background = color_from_middle(risk.Table$`VaR Normal`,'pink','pink')) %>%
  formatPercentage('VaR HS 1Y', 1) %>%
  formatStyle('VaR HS 1Y', background = color_from_middle(risk.Table$`VaR HS 1Y`,'pink','pink')) %>%
#  formatPercentage('VaR Share', 1) %>%
#  formatStyle('VaR Share', background = color_from_middle(risk.Table$`VaR_Share`,'pink','pink')) %>%
  formatPercentage('ES MSGARCH', 1) %>%
  formatStyle('ES MSGARCH', background = color_from_middle(risk.Table$`ES MSGARCH`,'pink','pink')) %>%
    formatPercentage('ES bootstrap', 1) %>%
  formatStyle('ES bootstrap', background = color_from_middle(risk.Table$`ES bootstrap`,'pink','pink')) %>%
  formatPercentage('VaR bootstrap', 1) %>%
  formatStyle('VaR bootstrap', background = color_from_middle(risk.Table$`VaR bootstrap`,'pink','pink')) %>%
formatPercentage('VaR Share', 1) %>%
formatStyle('VaR Share', background = color_from_middle(risk.Table$`VaR Share`,'pink','pink')) %>%
    formatPercentage('ind VaR MSGARCH', 1) %>%
  formatStyle('ind VaR MSGARCH', background = color_from_middle(risk.Table$`ind VaR MSGARCH`,'pink','pink'))

##dp$risk %>% subset((dp$risk$SharePortfolio==0 | is.na(dp$risk$SharePortfolio))& dp$risk$Name != 'Portfolio:'
```

# Overview:

```{r include = TRUE, echo=FALSE, fig.align='center'}

dp$risk %>% subset(!(dp$risk$SharePortfolio>0.0001) | dp$risk$Name == 'Portfolio:'
                   ,select=names(dp$risk)[c(2:18,28,37,40,42,44)]) %>%
  mutate(std_log_returns = std_log_returns * 100) %>% 
  mutate(std_log_returns_1Y = std_log_returns_1Y * 100) %>%
  mutate(VolaN1_MSGARCH = VolaN1_MSGARCH * 100) %>%
  dplyr::rename(`ind VaR MSGARCH`=ind_VaR_MSGARCH)%>%
  dplyr::rename(`250D CAPM Return`=`250D.CAPM.Return`)%>%
  dplyr::rename(`250D log Return`=`250D.logReturn`)%>%
  dplyr::rename(`Jensen Alpha`=Jensen.Alpha)%>%
  dplyr::rename(`std log returns`=std_log_returns)%>%  
  dplyr::rename(`std log returns 1Y`=std_log_returns_1Y)%>%  
  dplyr::rename(`std N1 MSGARCH`= VolaN1_MSGARCH)%>%
  dplyr::rename(`ES MSGARCH`= ES_MSGARCH)%>%
  plyr::arrange(!SharePortfolio)  -> risk.Table 

#c(-1,-25,-26,-29,-30,-32,-33,-39,-40,-42)
risk.Table <- replace(risk.Table, is.na(risk.Table),0)

datatable(risk.Table,extensions = 'Buttons', 
          options = list(pageLength = 100,dom = 'Bfrtip',
            buttons = list('copy', 'csv', 'excel', 'pdf', 'print',
            list(extend = 'colvis', visible=F, columns = c(3:dim(risk.Table)[2]))))
          ) %>%
  formatRound('Value', digits = 0, interval = 3, mark = " ")%>%
  formatPercentage('SharePortfolio', 1) %>%
  formatStyle('SharePortfolio', background = color_from_middle(risk.Table$SharePortfolio,'pink','lightblue')) %>%
  formatRound('Beta', digits = 2, interval = 3, mark = " ")%>%
  formatStyle('Beta', background = color_from_middle(risk.Table$Beta,'pink','pink')) %>%
  formatRound('Beta1Y', digits = 2, interval = 3, mark = " ")%>%
  formatStyle('Beta1Y', background = color_from_middle(risk.Table$Beta1Y,'pink','pink')) %>%
  formatPercentage('250D log Return', 1) %>%
  formatStyle('250D log Return', background = color_from_middle(risk.Table$`250D log Return`,'pink','pink')) %>%
  formatPercentage('250D CAPM Return', 1) %>%
  formatStyle('250D CAPM Return', background = color_from_middle(risk.Table$`250D CAPM Return`,'pink','pink')) %>%
    formatRound('Jensen Alpha', digits = 2, interval = 3, mark = " ")%>%
  formatStyle('Jensen Alpha', background = color_from_middle(risk.Table$`Jensen Alpha`,'pink','lightblue')) %>%
 formatRound('std log returns', digits = 1, interval = 3, mark = " ")%>%
 formatStyle('std log returns', background = color_from_middle(risk.Table$`std log returns`,'pink','pink')) %>%
 formatRound('std log returns 1Y', digits = 1, interval = 3, mark = " ")%>%
 formatStyle('std log returns 1Y', background = color_from_middle(risk.Table$`std log returns 1Y`,'pink','pink')) %>%
    formatRound('std N1 MSGARCH', digits = 1, interval = 3, mark = " ")%>%
  formatStyle('std N1 MSGARCH', background = color_from_middle(risk.Table$`std N1 MSGARCH`,'pink','pink')) %>%
  formatPercentage('VaR Normal std1Y', 1) %>%
  formatStyle('VaR Normal std1Y', background = color_from_middle(risk.Table$`VaR Normal std1Y`,'pink','pink')) %>%
  formatPercentage('VaR Normal', 1) %>%
  formatStyle('VaR Normal', background = color_from_middle(risk.Table$`VaR Normal`,'pink','pink')) %>%
  formatPercentage('VaR HS 1Y', 1) %>%
  formatStyle('VaR HS 1Y', background = color_from_middle(risk.Table$`VaR HS 1Y`,'pink','pink')) %>%
#  formatPercentage('VaR Share', 1) %>%
#  formatStyle('VaR Share', background = color_from_middle(risk.Table$`VaR_Share`,'pink','pink')) %>%
  formatPercentage('ES MSGARCH', 1) %>%
  formatStyle('ES MSGARCH', background = color_from_middle(risk.Table$`ES MSGARCH`,'pink','pink')) %>%
    formatPercentage('ES bootstrap', 1) %>%
  formatStyle('ES bootstrap', background = color_from_middle(risk.Table$`ES bootstrap`,'pink','pink')) %>%
  formatPercentage('VaR bootstrap', 1) %>%
  formatStyle('VaR bootstrap', background = color_from_middle(risk.Table$`VaR bootstrap`,'pink','pink')) %>%
formatPercentage('VaR Share', 1) %>%
formatStyle('VaR Share', background = color_from_middle(risk.Table$`VaR Share`,'pink','pink')) %>%
    formatPercentage('ind VaR MSGARCH', 1) %>%
  formatStyle('ind VaR MSGARCH', background = color_from_middle(risk.Table$`ind VaR MSGARCH`,'pink','pink'))

##dp$risk %>% subset((dp$risk$SharePortfolio==0 | is.na(dp$risk$SharePortfolio))& dp$risk$Name != 'Portfolio:'
```